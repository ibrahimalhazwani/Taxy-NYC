---
title: "R Notebook"
output: html_notebook
---

Install the libraries usefull for the project.
```{r}
install.packages('tidyverse')
install.packages('sf')
install.packages('dplyr')
install.packages('ggdark')
```

Load the libraries for running the project.
```{r}
library(tidyverse)
library(sf)
library(dplyr)
library(ggdark)
library(cowplot)
```

Load the data, data avaiable at the website [LINK]
```{r}
yellow_df <- read_csv("../data/yellow_tripdata_2019-01.csv")
green_df <- read_csv("../data/green_tripdata_2019-01.csv")
fhv_df <- read_csv("../data/fhv_tripdata_2019-01.csv")
map_nyc <- read_sf("../data/taxi_zones.shp")
```

# Data preprocessing

Change the column name of the map dataframe so later will be possible to make the left join.
```{r}
map_nyc$PULocationID <- map_nyc$LocationID
map_nyc$DOLocationID <- map_nyc$LocationID
```

Edit the yellow cab dataframe in order to reduce the dimension and keep only the column needed for creating the map.
```{r}
yellow_df_sample <- yellow_df[sample(nrow(yellow_df), 753625), ] %>% 
  subset(select = c(tpep_pickup_datetime,tpep_dropoff_datetime,PULocationID,DOLocationID, passenger_count)) 

yellow_nyc_PUL <- left_join(yellow_df_sample,map_nyc,"PULocationID") %>%
  subset(select = c(passenger_count,tpep_pickup_datetime,tpep_dropoff_datetime,PULocationID,Shape_Leng,zone,borough, geometry)) %>%
  drop_na()

yellow_nyc_DOL <- left_join(yellow_df_sample,map_nyc,"DOLocationID") %>%
  subset(select = c(passenger_count,tpep_pickup_datetime,tpep_dropoff_datetime,DOLocationID,Shape_Leng,zone,borough, geometry) )%>%
  drop_na()
```

Edit the green cab dataframe in order to keep only the column usefull for the creation of the map.
```{r}
green_df <- subset(green_df, select = c(lpep_pickup_datetime,lpep_dropoff_datetime,PULocationID,DOLocationID, passenger_count)) 

green_nyc_PUL <- left_join(green_df,map_nyc,"PULocationID") %>%
  subset(select = c(passenger_count,lpep_pickup_datetime,lpep_dropoff_datetime,PULocationID,Shape_Leng,zone,borough, geometry)) %>%
  drop_na()

green_nyc_DOL <- left_join(green_df,map_nyc,"DOLocationID") %>%
  subset(select = c(passenger_count,lpep_pickup_datetime,lpep_dropoff_datetime,DOLocationID,Shape_Leng,zone,borough, geometry)) %>%
  drop_na()

```

Edit the fhv dataframe by dropping all the na row and keep only the one usefull for the map.
```{r}
fhv_df <- drop_na(fhv_df)
fhv_sample <- fhv_df[sample(nrow(fhv_df), 743219), ]

fhv_nyc_PUL <- left_join(fhv_sample, map_nyc, "PULocationID") %>%
  subset(select = c(pickup_datetime,dropoff_datetime,PULocationID,Shape_Leng,zone,borough, geometry)) %>%
  drop_na()

fhv_nyc_DOL <- left_join(fhv_sample, map_nyc, "DOLocationID") %>%
  subset(select = c(pickup_datetime,dropoff_datetime,DOLocationID,Shape_Leng,zone,borough, geometry)) %>%
  drop_na()
```

Plot the NYC map
```{r}
ggplot()+
  geom_sf (data = map_nyc)
```

